generator client {
  provider = "prisma-client-py"
  interface = "asyncio"
  recursive_type_depth = 5
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  sessions  StudySession[]
  subjects  Subject[]
  flashcards Flashcard[]
  tasks     Task[]
  semesterConfig SemesterConfig?
}

model Subject {
  id        Int      @id @default(autoincrement())
  name      String
  color     String   @default("#000000")
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  sessions  StudySession[]
  flashcards Flashcard[]
  tags      Tag[]
  tasks     Task[]
  exams     Exam[]
}

model StudySession {
  id        Int      @id @default(autoincrement())
  startTime DateTime @default(now())
  endTime   DateTime?
  duration  Int?     // In minutes (Actual)
  plannedDuration Int? // In minutes (Target)
  isFocusMode Boolean @default(false)
  interruptions Int @default(0) // Number of pauses/interruptions
  subjectId Int
  subject   Subject  @relation(fields: [subjectId], references: [id])
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  notes     String?
}

model Flashcard {
  id        Int      @id @default(autoincrement())
  front     String
  back      String
  subjectId Int
  subject   Subject  @relation(fields: [subjectId], references: [id])
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  
  // FSRS fields
  stability Float    @default(0)
  difficulty Float   @default(0)
  elapsedDays Float  @default(0)
  scheduledDays Float @default(0)
  reps      Int      @default(0)
  lapses    Int      @default(0)
  state     Int      @default(0) // 0: New, 1: Learning, 2: Review, 3: Relearning
  lastReview DateTime?
  due       DateTime @default(now())
  
  tags      Tag[]
}

model Tag {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  subjects  Subject[]
  flashcards Flashcard[]
}

model Task {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  isCompleted Boolean  @default(false)
  dueDate     DateTime?
  priority    Int      @default(0) // 0: None, 1: Low, 2: Medium, 3: High
  
  subjectId   Int?
  subject     Subject? @relation(fields: [subjectId], references: [id])
  
  userId      Int
  user        User     @relation(fields: [userId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SemesterConfig {
  id              Int      @id @default(autoincrement())
  userId          Int      @unique
  user            User     @relation(fields: [userId], references: [id])
  semesterName    String   // e.g., "Fall 2024"
  startDate       DateTime
  endDate         DateTime
  weeklyStudyHours Int     // Available hours per week
  learningStyle   String?  // "visual", "reading", "practice", etc.
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Exam {
  id          Int      @id @default(autoincrement())
  subjectId   Int
  subject     Subject  @relation(fields: [subjectId], references: [id])
  examType    String   // "midterm", "final", "quiz"
  examDate    DateTime
  weight      Int      @default(0) // Percentage weight (0-100)
  topics      String?  // JSON array of topics
  createdAt   DateTime @default(now())
}
